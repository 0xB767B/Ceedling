#!/usr/bin/env ruby

require 'rubygems'
require 'fileutils'
require 'thor'

def here
  File.dirname(__FILE__) + "/.."
end

class CeedlingTasks < Thor
  include Thor::Actions

  desc "new PROJECT_NAME", "create a new ceedling project"
  method_option :nodocs, :type => :boolean, :default => false, :desc => "No docs in vendor directory"
  def new(name)
    ceedling_path = File.join(name, 'vendor', 'ceedling')
    source_path   = File.join(name, 'src')
    test_path     = File.join(name, 'test')
    build_path    = File.join(name, 'build')

    [ceedling_path, source_path, test_path, build_path].each do |d|
      FileUtils.mkdir_p d
    end

    folders = %w{plugins lib release vendor}
    folders << 'docs' if options[:nodocs]

    folders.map do |f|
      {:src => File.join(here, f), :dst => File.join(ceedling_path, f)}
    end.each do |f|
      directory f[:src], f[:dst]
    end

    files = %w{rakefile.rb project.yml}
    files.each do |f|
      copy_file File.join(here, 'assets', f), File.join(name, f)
    end

    puts "\n"
    puts "Project '#{name}' created!"
    puts " - Tool documentation is located in vendor/ceedling/docs" if not options[:nodocs]
    puts " - Execute 'rake -T' to view available test & build tasks"
    puts ''
  end
end

CeedlingTasks.source_root here
CeedlingTasks.start
